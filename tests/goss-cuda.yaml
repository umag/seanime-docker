# CUDA variant specific tests
# Base image: Ubuntu + NVIDIA CUDA
# User: seanime (UID 1001, GID 1001)
# FFmpeg: Ubuntu repos with NVENC support

port:
  tcp:43211:
    listening: true
    ip:
      - 127.0.0.1

process:
  seanime:
    running: true

http:
  http://localhost:43211:
    status: 200
    timeout: 5000
    allow-insecure: true
    no-follow-redirects: false

user:
  seanime:
    exists: true
    uid: 1001
    gid: 1001
    groups:
      - seanime
      - video
    shell: /bin/bash
    home: /home/seanime

group:
  seanime:
    exists: true
    gid: 1001

file:
  /app/seanime:
    exists: true
    owner: seanime
    group: seanime
    filetype: file
  /usr/bin/ffmpeg:
    exists: true
    mode: "0755"
    owner: root
    group: root
    filetype: file

package:
  ffmpeg:
    installed: true
  ca-certificates:
    installed: true
  curl:
    installed: true

command:
  ffmpeg-version:
    exec: ffmpeg -version
    exit-status: 0
    stdout:
      - "ffmpeg version"
  ffmpeg-hwaccels:
    exec: ffmpeg -hwaccels
    exit-status: 0
    stdout:
      - "cuda"
  ffmpeg-nvenc:
    exec: ffmpeg -encoders 2>&1 | grep -i nvenc
    exit-status: 0
